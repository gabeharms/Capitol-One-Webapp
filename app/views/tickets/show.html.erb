<% provide(:title, @ticket.title) %>
<div class="row">
  <div>
      <h3>Issue: <%= @ticket.title %></h3>
      <% if @ticket.employee_id != nil %>
        This ticket was created by employee: <%= @employee.first_name %><br>
      <% elsif !employee_logged_in?  %>
        This ticket was created by you.<br>  
      <% end %>
      <% if employee_logged_in? && @ticket.customer_id != nil %>
        This ticket belongs to customer: <%= @customer.first_name %> <%= @customer.last_name %><br>  
      <% end %>
      <% if @ticket.ticket_category_id != nil %>  
        Category: <%= @category.name %>
      <% end %>
      <ol class="ticket-list">
        <!-- if comment.initiator is true then color it for employee -->
        <% @comments.each do |comment| %>
          <% if customer_comment? (comment.initiator) %>
            <li class="customer-comment-li">
              <div class="ticket-info">
              <p class="comment-name"><%= @ticket.customer.first_name %></p>
          <% else %>
            <li class="employee-comment-li">
              <div class="ticket-info">
              <p class="comment-name">Employee (<%= comment.employee.first_name %>)</p>
          <% end %>
                <%= comment.message %>
                <%= image_tag comment.picture.url if comment.picture? %>
                <p class="timestamp">
                  <%= comment.created_at.strftime('%b %d, %Y at %I:%M %p') %>
                </p>
              </div>
              <% if employee_logged_in? %>
                <%= button_to "Delete", { action: "destroy", :controller => "comments", id: comment.ticket.id, comment_id: comment.id },
                                  method: :delete, data: { confirm: "Are you sure?" }, class: 'btn btn-danger delete-comment-button' %> 
                <div class="clear-float"></div>
              <% elsif current_customer?(@ticket.customer) %>
                <% if customer_comment? (comment.initiator) %>
                  <%= button_to "Delete", { action: "destroy", :controller => "comments", id: comment.ticket.id, comment_id: comment.id },
                                  method: :delete, data: { confirm: "Are you sure?" }, class: 'btn btn-danger delete-comment-button' %> 
                <%end%>
                <div class="clear-float"></div>
              <% end %>              
            </li>
        <% end %>
      </ol>
      <div class="comment-box">
        <%= form_for(@comment, html: { multipart: true }) do |f| %>
          <%= f.text_area :message, placeholder: "Post your reply here...", class: 'new-comment-field' %>
          <%= f.hidden_field :id, :value => @ticket.id %>
          <%= f.submit "Post", class: "btn btn-primary post-comment" %>
          <% if customer_logged_in? %>
            <span class="picture">
              <%= f.file_field :picture, accept: 'image/jpeg,image/gif,image/png' %>
            </span>
          <% end %>
        <% end %>
        <script type="text/javascript">
          $('#ticket_picture').bind('change', function() {
            size_in_megabytes = this.files[0].size/1024/1024;
            if (size_in_megabytes > 5) {
              alert('Maximum file size is 5MB. Please choose a smaller file.');
            }
          });
        </script>
      </div>
  </div>
</div>